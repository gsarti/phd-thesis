%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% QUARTO RUG PHD THESIS STYLE FILE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 1. CORE DOCUMENT PACKAGES
%% Essential packages for document structure and encoding
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Input/Output encoding and font handling
\usepackage[T1]{fontenc}                    % T1 font encoding for better character support
\usepackage[utf8]{inputenc}                 % UTF-8 input encoding for international characters
\usepackage{textcomp}                       % Additional text symbols and companions
\usepackage{marvosym}                        % Additional symbols (e.g., Euro symbol)

% Basic document structure and utilities
\usepackage{etoolbox}                       % Programming tools for LaTeX
\usepackage{calc}                           % Enhanced calculation capabilities
\usepackage{xstring}                        % String manipulation utilities
\usepackage{xspace}                         % Intelligent spacing after macros

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 2. TYPOGRAPHY AND FONTS
%% Font selection, sizing, and typographic enhancements
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Font families
\usepackage{fbb}                            % Bembo-style serif font (Cardo/EB Garamond family)
\usepackage[defaultsans]{lato}              % Lato as default sans-serif font
\usepackage{lmodern}                        % Latin Modern fonts (enhanced Computer Modern)
\usepackage{times}                          % Times Roman font family
\usepackage{inconsolata}                    % Inconsolata monospace font for code

% Typography enhancements
\usepackage{microtype}                      % Micro-typographic adjustments (kerning, spacing)
\usepackage{soul}                           % Letter spacing and highlighting
\usepackage{relsize}                        % Relative font size changes
\usepackage{mfirstuc}                       % First letter capitalization utilities

% Special symbols and mathematical fonts
\usepackage{latexsym}                       % LaTeX symbol fonts
\usepackage{amsfonts}                       % AMS mathematical fonts
\usepackage{amssymb}                        % AMS mathematical symbols
\usepackage[mathscr]{euscript}              % Euler script fonts for mathematics

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 3. PAGE LAYOUT AND GEOMETRY
%% Page dimensions, margins, and overall document layout
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Page geometry and margins
\usepackage[margin=25mm]{geometry}         % Set uniform 25mm margins
\usepackage{changepage}                     % Tools for changing page layout mid-document
\usepackage{lscape}                         % Landscape page orientation
\usepackage{rotating}                       % Rotate tables, figures, and text

% Page setup commands (using memoir class features)
\setstocksize{240mm}{170mm}                % Physical paper dimensions
\settrimmedsize{240mm}{170mm}{*}           % Trimmed page size
\setlength{\trimtop}{\stockheight}
\addtolength{\trimtop}{-\paperheight}
\setlength{\trimedge}{\stockwidth}
\addtolength{\trimedge}{-\paperwidth}
\settrims{0.5\trimtop}{0.5\trimedge}       % Center the page on stock
\settypeblocksize{170mm}{120mm}{*}         % Text block dimensions
\setlrmargins{30mm}{*}{*}                  % Left/right margins
\setulmargins{35mm}{*}{*}                  % Upper/lower margins
\checkandfixthelayout                       % Validate and fix layout

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 4. MATHEMATICAL TYPESETTING
%% Enhanced mathematics support and formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{amsmath}                        % AMS mathematical environments and commands
\usepackage{mathtools}                      % Extensions to amsmath
\usepackage{bm}                             % Bold mathematics symbols
\usepackage{siunitx}                        % Scientific units and number formatting

% Configure siunitx for consistent number formatting
\sisetup{detect-weight=true,detect-all}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 5. TABLES AND TABULAR ENVIRONMENTS
%% Enhanced table formatting and structure
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{array}                          % Extended array and tabular environments
\usepackage{booktabs}                       % Professional table formatting (toprule, midrule, etc.)
\usepackage{longtable}                      % Tables spanning multiple pages
\usepackage{multirow}                       % Multi-row cells in tables
\usepackage{multicol}                       % Multiple column layouts
\usepackage{tabu}                           % Advanced tabular environments
\usepackage{tablefootnote}                  % Footnotes within tables

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 6. FIGURES, GRAPHICS, AND VISUAL ELEMENTS
%% Image handling, graphics, and visual enhancements
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Core graphics packages
\usepackage{graphicx}                       % Include external graphics
\usepackage{grffile}                        % Enhanced file name handling for graphics
\usepackage[export]{adjustbox}              % Advanced box adjustment and clipping
\usepackage{epstopdf}                       % Automatic EPS to PDF conversion

% Figure and caption formatting
\usepackage{float}                          % Enhanced float placement ([H] option)
\usepackage{caption}                        % Customizable captions
\usepackage{subcaption}                     % Subfigures and subcaptions

% Drawing and diagram packages
\usepackage{tikz}                           % Programmatic drawing and diagrams
\usepackage{forest}                         % Tree diagrams
\usepackage{pifont}                         % Pi fonts and Zapf Dingbats

% Color support
\usepackage[dvipsnames,svgnames,x11names,table]{xcolor}  % Comprehensive color support

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 7. LISTS AND ENUMERATION
%% Enhanced list formatting and customization
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[inline, shortlabels]{enumitem} % Customizable lists and enumerations
\usepackage{numprint}                       % Number formatting in lists
\usepackage[super]{nth}                     % Ordinal number formatting (1st, 2nd, etc.)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 8. CODE AND VERBATIM ENVIRONMENTS
%% Code highlighting and verbatim text formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{listings}                       % Source code listings
\usepackage{fancyvrb}                       % Enhanced verbatim environments

% Define colors for syntax highlighting
\definecolor{shadecolor}{RGB}{248,248,248}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{emph}{RGB}{166,88,53}
\definecolor{nightblue}{RGB}{9,49,105}
\definecolor{keywords}{RGB}{207,33,46}
\definecolor{lightpurple}{RGB}{130,81,223}
\definecolor{lightredclear}{RGB}{234,153,153}
\definecolor{lightreddim}{RGB}{224,102,102}
\definecolor{lightblueclear}{RGB}{159,197,232}
\definecolor{lightbluedim}{RGB}{111,168,220}

% Code highlighting environments and commands
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}

% Syntax highlighting token definitions
\newcommand{\ImportTok}[1]{\textcolor{emph}{#1}}
\newcommand{\CommentTok}[1]{\textcolor{codegreen}{\textit{#1}}}
\newcommand{\StringTok}[1]{\textcolor{nightblue}{#1}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\FunctionTok}[1]{\textcolor{lightpurple}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor{emph}{\textbf{#1}}}
\newcommand{\VariableTok}[1]{#1}

% Enhanced shaded environment with line numbers
\newenvironment{Shaded*}[1][]
 {\begin{snugshade}\begin{Highlighting}[#1]}
 {\end{Highlighting}\end{snugshade}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 9. ALGORITHMS AND PSEUDOCODE
%% Algorithm typesetting and pseudocode environments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[algoruled,ruled,vlined,noend]{algorithm2e}  % Algorithm environments
\usepackage[]{algorithmicx}                             % Algorithmic pseudocode base
\usepackage{algpseudocode}                              % Pseudocode formatting

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 10. CROSS-REFERENCES AND HYPERLINKS
%% Navigation, references, and hyperlink management
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{bookmark}                       % Enhanced bookmarks for PDF
\usepackage{hyperref}                       % Hyperlinks and cross-references
\usepackage{url}                            % URL formatting and line breaking
\usepackage{xurl}                           % Extended URL support
\usepackage{cleveref}                       % Intelligent cross-referencing

% Hyperref configuration - clean black links
\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 11. SPECIAL FEATURES AND UTILITIES
%% Miscellaneous packages for special functionality
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{kantlipsum}                     % Lorem ipsum text generation
\usepackage{pgffor}                         % For loops and iterations
\usepackage{pdfpages}                       % Include external PDF pages
\usepackage{footnotehyper}                  % Hyperlinked footnotes
\usepackage{hwemoji}                        % Emoji support
\usepackage{fontawesome}                    % Font Awesome icons
\usepackage[normalem]{ulem}                 % Underlining and striking out text
\usepackage{framed}                         % Framed and shaded boxes

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 12. TYPOGRAPHY CONFIGURATION
%% Font sizes, line spacing, and text formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Suppress specific warnings
\hfuzz=1pt  % Suppress overfull hbox warnings under 1pt
\vfuzz=1pt  % Suppress overfull vbox warnings under 1pt

% Update deprecated memoir commands
\let\oldaddtodef\addtodef
\renewcommand{\addtodef}[3]{\apptocmd{#1}{#3}{}{}}
\newcommand{\pandocbounded}[1]{#1} % Placeholder for Pandoc bounded commands

% Line spacing and typography settings
\linespread{1.05}                           % 1.15x line spacing for readability

% Font size redefinitions for consistent typography
\renewcommand{\normalsize}{\fontsize{9.5pt}{12.6pt}\selectfont}
\renewcommand{\abstracttextfont}{\fontsize{9.5pt}{12.6pt}\selectfont}
\renewcommand{\footnotesize}{\fontsize{8pt}{10.6pt}\selectfont}

% Prevent overfull lines and improve spacing
\UseMicrotypeSet[protrusion]{basicmath}     % Disable protrusion for typewriter fonts
\setlength{\emergencystretch}{3em}          % Allow extra stretch to prevent overfull lines

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 13. CHAPTER AND SECTION STYLING
%% Custom chapter and section header formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Section heading styles
\setsecheadstyle{\noindent\bfseries}        % Section headers: bold, no indent
\setsubsecheadstyle{\secheadstyle}          % Subsection: same as section
\setsubsubsecheadstyle{\secheadstyle}       % Subsubsection: same as section

% Custom chapter style definition
\makeatletter
\makechapterstyle{main}{
  \chapterstyle{default}
  \renewcommand*{\chapterheadstart}{\vspace*{10pt}}
  \renewcommand*{\chapnamefont}{\Huge}
  \renewcommand*{\printchaptername}{
          \flushright\chapnamefont\MakeUppercase\@chapapp}
  \renewcommand{\printchapternum}{\chapnumfont \thechapter \medskip \hrule}
  \renewcommand*{\chapnumfont}{\chapnamefont}
  \renewcommand*{\chaptitlefont}{\bfseries\Huge}
  \renewcommand*{\printchaptertitle}[1]{
          \flushright
          \chaptitlefont{##1}
  }
}
\chapterstyle{main}                         % Apply the custom chapter style
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 14. TABLE OF CONTENTS AND PART FORMATTING
%% Customization of TOC, parts, and chapter formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Part title formatting
\renewcommand*{\partnumfont}{\Huge}
\renewcommand*{\partnamefont}{\Huge}
\renewcommand*{\parttitlefont}{\Huge\bfseries}
\renewcommand*{\printpartname}{\partnamefont\MakeUppercase\partname}
\renewcommand*{\printparttitle}[1]{\parttitlefont{#1}}

% Table of contents formatting
\renewcommand{\printtoctitle}[1]{\vspace{-2.5cm}\flushright\Huge\bfseries#1\vspace{-1cm}}
\renewcommand*{\cftpartfont}{\bfseries}
\renewcommand*{\cftpartpagefont}{\bfseries}
\renewcommand*{\cftchapterfont}{\bfseries}
\renewcommand*{\cftchapterpagefont}{\cftchapterfont\bfseries}

% TOC depth and formatting adjustments
\setcounter{tocdepth}{2}                    % Show sections and subsections in TOC
\makeatletter
\renewcommand*{\l@chapter}[2]{\l@chapapp{{#1}}{#2}{\cftchaptername}}
\renewcommand*{\l@appendix}[2]{\l@chapapp{{#1}}{#2}{\cftchaptername}}
\renewcommand{\@pnumwidth}{2em}             % Width for page numbers in TOC
\renewcommand{\@tocrmarg}{3em}              % Right margin for TOC entries
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 15. HEADERS AND FOOTERS
%% Page header and footer configuration
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Configure page style with headers
\addtopsmarks{ruled}{\nouppercaseheads}{}
\makeoddhead{ruled}{\rightmark}{}{\thepage}    % Odd pages: section | page
\makeevenhead{ruled}{\thepage}{}{\leftmark}    % Even pages: page | chapter
\makeoddfoot{ruled}{}{}{}                      % Empty footers
\makeevenfoot{ruled}{}{}{}
\pagestyle{ruled}                              % Apply the ruled page style

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 16. ABSTRACT AND CAPTION FORMATTING
%% Abstract environment and figure/table caption styling
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Abstract formatting
\setlength\absleftindent{0.0in}
\setlength\absrightindent{0.0in}
\renewcommand*{\abstractname}{}
\newcommand{\absprelude}{\noindent\normalfont{\textbf{Abstract|}}\abstracttextfont}

% Caption formatting
\renewcommand{\figurename}{\textbf{Figure}}    % Bold "Figure" label
\captionnamefont{\bfseries}                    % Bold caption labels
\captionstyle{\itshape}                        % Italic caption text
\captiondelim{~|~}                             % Separator between label and text
\setlength{\belowcaptionskip}{-10pt}           % Reduce space below captions

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 17. CUSTOM COMMANDS AND ENVIRONMENTS
%% User-defined macros and environment definitions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Inline header commands for consistent formatting
\newcommand{\inlineheader}[1]{%
  \vspace{0.1cm}
  \noindent\textbf{#1}\quad
}

\newcommand{\inlineheadernoquad}[1]{%
  \vspace{0.1cm}
  \noindent\textbf{#1}
}

% Counter for research questions or similar numbered items
\newcounter{rqcounter}
\setcounter{rqcounter}{1}

% Tight list formatting (reduce spacing in lists)
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 18. FIGURE AND FLOAT CONFIGURATION
%% Image scaling and float placement settings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Automatic image scaling to prevent overflow
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother

% Default image scaling and placement
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\makeatletter
\def\fps@figure{htbp}                       % Default figure placement: here, top, bottom, page
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 19. PARAGRAPH AND SUBPARAGRAPH HANDLING
%% Quarto-specific paragraph formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Make paragraph and subparagraph free-standing (Quarto requirement)
\makeatletter
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}{
    \@ifstar
      \xxxParagraphStar
      \xxxParagraphNoStar
  }
  \newcommand{\xxxParagraphStar}[1]{\oldparagraph*{#1}\vspace{-5pt}\mbox{}}
  \newcommand{\xxxParagraphNoStar}[1]{\oldparagraph{#1}\vspace{-5pt}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}{
    \@ifstar
      \xxxSubParagraphStar
      \xxxSubParagraphNoStar
  }
  \newcommand{\xxxSubParagraphStar}[1]{\oldsubparagraph*{#1}\vspace{-5pt}\mbox{}}
  \newcommand{\xxxSubParagraphNoStar}[1]{\oldsubparagraph{#1}\vspace{-5pt}\mbox{}}
\fi
\makeatother

\setlength{\parskip}{0.3em}          % Set paragraph spacing
\setlength{\parindent}{0pt}           % No paragraph indentation

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 20. LONGTABLE AND FOOTNOTE COMPATIBILITY
%% Fixes for longtable and footnote interactions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Fix longtable compatibility issues
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother

% Enable footnotes in longtable environments
\makesavenoteenv{longtable}

% Prevent footnote line breaks
\interfootnotelinepenalty=10000

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 21. BIBLIOGRAPHY AND CITATION SUPPORT
%% Citation processing and bibliography formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Citation processing commands (for citeproc compatibility)
\NewDocumentCommand\citeproctext{}{}
\NewDocumentCommand\citeproc{mm}{%
  \begingroup\def\citeproctext{#2}\cite{#1}\endgroup}

% Citation formatting adjustments
\makeatletter
 \let\@cite@ofmt\@firstofone                % Allow citations to break across lines
 \def\@biblabel#1{}                         % Remove brackets around citation numbers
 \def\@cite#1#2{{#1\if@tempswa , #2\fi}}   % Custom citation format
\makeatother

% CSL (Citation Style Language) reference formatting
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}

\newenvironment{CSLReferences}[2] % #1 hanging-indent, #2 entry-spacing
 {\begin{list}{}{%
  \setlength{\itemindent}{0pt}
  \setlength{\leftmargin}{0pt}
  \setlength{\parsep}{0pt}
  % Enable hanging indent if param 1 is 1
  \ifodd #1
   \setlength{\leftmargin}{\cslhangindent}
   \setlength{\itemindent}{-1\cslhangindent}
  \fi
  % Set entry spacing
  \setlength{\itemsep}{#2\baselineskip}}}
 {\end{list}}

% CSL formatting commands
\newcommand{\CSLBlock}[1]{\hfill\break\parbox[t]{\linewidth}{\strut\ignorespaces#1\strut}}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 22. FLOAT DEFINITIONS AND LIST MANAGEMENT
%% Code listings and float environment setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define standard names for document elements
\makeatletter
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Contents}
\else
  \newcommand\contentsname{Contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{Figures}
\else
  \newcommand\listfigurename{Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{Tables}
\else
  \newcommand\listtablename{Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\makeatother

% Code listing float environment
\makeatletter
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% END OF STYLE FILE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%